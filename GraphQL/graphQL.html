<!DOCTYPE html>
<html>

<head>
	<title>
		GraphQL
	</title>
</head>

<body>
	<h1>Index</h1>

	<ol>
		<li><a href="#what-is-graphql">What is GraphQL?</a></li>
		<li><a href="#create-a-project">Create a project</a></li>
		<li><a href="#add-graphql-to-our-project">Add GraphQL to our project</a></li>
	</ol>

	<h2 id="what-is-graphql">What is GraphQL?</h2>
	<p>
		A couple years ago Facebook was facing a challenge with their social network. When you're asking for information
		about friends or their friends' friends, the current query options for the database in the market couldn't
		support. So anytime you go further than four or five levels deep in your neetwork, Facebook couldn't support it.
		This is why they created GraphQL.
	</p>
	<p>
		GraphQL <mark>
			is a query language</mark>
		for any kind of API and it is <mark>
			able
		</mark> to fulfill any <mark>
			queries across multiple databases
		</mark>.
	</p>

	<p>
		The <mark>
			main benefits
		</mark> of using it is that <mark>
			you can ask for
		</mark> exactly <mark>
			what you want
		</mark>, and you <mark>
			get those results and nothing else
		</mark>.
	</p>

	<p>
		GraphQL <mark>
			allows
		</mark> to describe <mark>
			what type of data you can expect
		</mark>.
	</p>

	<h2 id="create-a-project">Create a project</h2>
	<p>
		We have to go to the folder and then execute "<mark>
			npm init
		</mark>" (We can let all the default options). After this the
		file <mark>
			package.json will be created
		</mark>.
	</p>

	<p>
		Now we need to <mark>
			install the dependecies
		</mark> of the package.json file. We will install them with the command "<mark>
			npm install --save
		</mark>"
	</p>

	<p>
		We also want to <mark>
			install
		</mark> <mark>
			express
		</mark> and <mark>
			nodemon
		</mark>. For that we use the command "<mark>
			npm install --save express nodemon
		</mark>"
	</p>

	<p>
		Now we want to <mark>
			install
		</mark> the dev <mark>
			dependencies
		</mark>: npm <mark>
			install --save-dev babel-cli babel-preset-env babel-preset-stage-0
		</mark>
	</p>

	<p>
		Once we have those packages installed, let's click on the <mark>
			package.json
		</mark> file, and we'll <mark>
			insert a script
		</mark> when we
		start our server. <mark>
			"start" : "nodemon ./index.js --exec babel-node" -e js
		</mark>
	</p>
	<img src="../imagenes/graphQL/start-script.png" alt="start script">

	<ul>
		<li><mark>
				nodemon
			</mark> <mark>
				restart the server whenever we change a file
			</mark> in the server.</li>
		<li><mark>
				./index.js
			</mark> is the <mark>
				entry point
			</mark> of the server</li>
		<li>The remaning code: "<mark>
				--exec babel-node -e js
			</mark>" is basically making sure that <mark>
				we can run ES6
			</mark> code inside of node.</li>
	</ul>
	<p>
		Now we have to <mark>
			create a new file
		</mark> called "<mark>
			.babelrc
		</mark>" . This file will contains just <mark>
			one javascript object
		</mark> which have all the <mark>
			settings for babel
		</mark>. So basically those two presets will <mark>
			allow us to run ES6
		</mark> code in our server. It wil <mark>
			precompile the code
			into Javascript code that the browser
		</mark> or any Javascript compiler <mark>
			can read
		</mark>.
	</p>
	<img src="../imagenes/graphQL/babel-rc-file-content.PNG" alt="babelrc file">

	<p>
		Let's <mark>
			create
		</mark> another <mark>
			file
		</mark> called "<mark>
			index.js
		</mark>"
	</p>

	<!-- HTML generated using hilite.me -->
	<div
		style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
		<pre style="margin: 0; line-height: 125%"><span style="color: #75715e">// import express</span>
<span style="color: #66d9ef">import</span> <span style="color: #a6e22e">express</span> <span style="color: #a6e22e">from</span> <span style="color: #e6db74">&#39;express&#39;</span><span style="color: #f8f8f2">;</span>

<span style="color: #75715e">// Create the app and run express</span>
<span style="color: #66d9ef">const</span> <span style="color: #a6e22e">app</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">express</span><span style="color: #f8f8f2">();</span>

<span style="color: #75715e">// *** Create the base server ***</span>

<span style="color: #75715e">// When calling this url &#39;/&#39; we are going to give a particular response</span>
<span style="color: #a6e22e">app</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">get</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;/&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">(</span><span style="color: #a6e22e">req</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">res</span><span style="color: #f8f8f2">)</span> <span style="color: #f92672">=&gt;</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #a6e22e">res</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">send</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;GraphQL is amazing&#39;</span><span style="color: #f8f8f2">);</span>
<span style="color: #f8f8f2">});</span>

<span style="color: #75715e">// Listen in the port 8080. When the server starts it shows a log message to represents</span>
<span style="color: #75715e">// that the server is running on localhost:8080/graphql</span>
<span style="color: #a6e22e">app</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">listen</span><span style="color: #f8f8f2">(</span><span style="color: #ae81ff">8080</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">()</span> <span style="color: #f92672">=&gt;</span> <span style="color: #a6e22e">console</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">log</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;Running server on port localhost:8080/graphql&#39;</span><span style="color: #f8f8f2">));</span>
</pre>
	</div>

	<p>
		<mark>
			Start the server
		</mark> with the command: "<mark>
			npm start
		</mark>" . <mark>
			This will start our script called "start" declared in the package.json
		</mark> file.
	</p>
	<img src="../imagenes/graphQL/server-started-01.PNG" style="border:solid 1px;" alt="first time server started">

	<h2 id="add-graphql-to-our-project">Add GraphQL to our project</h2>
	
	<p>
		Now that we have our server set up, let's <mark>
			add GraphQL to it
		</mark> (it is important to point out that the name's folder that contains our project shouldn't be name as
		'GraphQL' because it will refuse to install the dependencies if the folder is name 'GraphQL').
	</p>
	<p>
		We're going to <mark>
			create a new file
		</mark> and we'll call this file '<mark>
			schema.js
		</mark>'. This is going to be our <mark>
			first schema
		</mark>, in this file what I want you to do is basically <mark>
			import 'buildSchema' from graphQL
		</mark>.
	</p>
	<img src="../imagenes/graphQL/schema-js.PNG" alt="create schema.js file">

	<!-- HTML generated using hilite.me -->
	<div
		style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
		<pre style="margin: 0; line-height: 125%"><span style="color: #75715e">// import &#39;buildSchema&#39; from graphql </span>
<span style="color: #66d9ef">import</span> <span style="color: #f8f8f2">{</span> <span style="color: #a6e22e">buildSchema</span> <span style="color: #f8f8f2">}</span> <span style="color: #a6e22e">from</span> <span style="color: #e6db74">&#39;graphql&#39;</span><span style="color: #f8f8f2">;</span>

<span style="color: #75715e">// Create an object which is called schema, and we&#39;ll use the function buildSchema that we just imported, </span>
<span style="color: #75715e">// and then use template strings and basically start our schema. </span>
<span style="color: #75715e">// The first thing we want <mark>to do is a query</mark>, so the <mark>type is call Query</mark>, and <mark>that query is expecting a</mark> </span>
<span style="color: #75715e">// a <mark>property called hello</mark>, which <mark>is a string</mark>.</span>
<span style="color: #66d9ef">const</span> <span style="color: #a6e22e">schema</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">buildSchema</span><span style="color: #f8f8f2">(</span><span style="color: #960050; background-color: #1e0010">`</span>
    <span style="color: #a6e22e">type</span> <span style="color: #a6e22e">Query</span><span style="color: #f8f8f2">{</span>
        <span style="color: #a6e22e">hello</span> <span style="color: #f92672">:</span> <span style="color: #f8f8f2">String</span>
    <span style="color: #f8f8f2">}</span>
<span style="color: #960050; background-color: #1e0010">`</span><span style="color: #f8f8f2">)</span>

<span style="color: #75715e">// export the default schema</span>
<span style="color: #66d9ef">export</span> <span style="color: #66d9ef">default</span> <span style="color: #a6e22e">schema</span><span style="color: #f8f8f2">;</span>
</pre>
	</div>

	<p>
		We need to <mark>
			import some new dependencies
		</mark> <mark>
			and
		</mark> the file <mark>
			schema that we've just created
		</mark>, and for that we're going to
		the '<mark>
			index.js
		</mark>' file and import:
	</p>

	<img src="../imagenes/graphQL/import-express-graphql-and-our-schema.PNG"
		alt="import graphqlhttp and our custom schema">

	<p>
		We add a <mark>
			new path
		</mark> for '<mark>
			/graphql
		</mark>':
	</p>
	<img src="../imagenes/graphQL/new-path.PNG" alt="new path">

	<p>
		In this part in "<mark>
			app.use
		</mark>(/graphql)" we are telling <mark>
			which resolver
		</mark> (to retrieve data) and <mark>
			which schema
		</mark> (our
		schema.js) want <mark>
			to use
		</mark> when we do this query.
	</p>
	<img src="../imagenes/graphQL/app-use.png" alt="app use">

	<p>
		To make this project work we <mark>
			need to install 2 more dependencies
		</mark>: "<mark>
			npm install --save express-graphql graphql
		</mark>"
	</p>

	<p>
		Now we can <mark>
			start the server
		</mark>: "npm start". And we can <mark>
			go to
		</mark> the path '<mark>
			localhost:8080/graphql
		</mark>' . And we can see our GraphQL server running.
	</p>
	<img src="../imagenes/graphQL/graphql-server-started.PNG" alt="graphql server started">

	<p>
		Now we <mark>
			click in "Docs" to see the schema
		</mark>:
	</p>
	<img src="../imagenes/graphQL/docs.PNG" alt="docs button">
	<img src="../imagenes/graphQL/schema-of-docs.png" alt="schema or doc">

	<p>
		So if we do the query our resolver will return the data:
	</p>
	<img src="../imagenes/graphQL/query.PNG" alt="first query">

	<p>
		To be able to make a graphQL query we need to define a schema which defines the query type and resolver for each
		api input. So the <mark>
			type definition
		</mark> provides what <mark>
			type of data we expect
		</mark> and the <mark>
			resolver gets the data
		</mark> for us.
	</p>

	<p>
		Let's <mark>
			create a query
		</mark> that <mark>
			return a type of data 'Friend'
		</mark>:
	</p>
	<img src="../imagenes/graphQL/type-friend.png" alt="friend data type">

	<p>
		Now we have to go to the index.js and <mark>
			change the resolver
		</mark>. Because right now we're resolving hello so if we were
		to do the query with friend and returning a Friend then this wouldn't work. It would actually trow us an error
		because the type doesn't match the resolver.
	</p>
	<img src="../imagenes/graphQL/new-friend-schema.png" alt="new-friend-schema">

	<p>
		Now we can query what kind of data I want to return from the friend, for example we can only get the id, first
		name, and last name:
	</p>
	<img src="../imagenes/graphQL/friend-custom-query.PNG" alt="retrieve only a few fields from friend">

	<p>
		Let's say that we want to have <mark>
			multiple emails
		</mark> for the email field. What we would do is <mark>
			create a new type called email
		</mark> and then make sure that this one
		is an <mark>
			array of email
		</mark>. And if you put an <mark>
			exclamation point
		</mark>, that means that this <mark>
			is a mandatory
		</mark>. If we don't have any
		exclamation point that means that this particular field can be left empty when we first create it.
	</p>

	<img src="../imagenes/graphQL/array-of-emails.png" alt="array of data type email">

	<p>
		Now we have to <mark>
			change the resolver
		</mark> so we can accept multiple emails. Otherwise it's not going to work. We are going to <mark>
			return an array of
			emails
		</mark>, so we will return an <mark>
			array of objects
		</mark>, <mark>
			each one with a property called "email" which is a string
		</mark>.
	</p>
	<img src="../imagenes/graphQL/change-resolver.png" alt="change the resolver to return an array of email">

	<p>
		Now if we query friends, we are going to get an array of emails: 
	</p>
	<img src="../imagenes/graphQL/query-array-of-emails.PNG" alt="query array of emails">



	<script src="../js/testMode.js"></script>
</body>


</html>